# language: ru
@authentication @smoke
Функционал: Аутентификация пользователя
  Пользователь должен иметь возможность выполнить вход в систему
  с помощью токена для получения доступа к действиям

  Контекст:
    Дано сервер приложения доступен
    И заголовок X-Api-Key установлен в "A94F2C7D8E1B4A6F9C3D2E5B8A7F1C0D"

  Сценарий: Успешная аутентификация пользователя
    Когда пользователь отправляет запрос с действием "LOGIN" и корректным токеном
    И внешний сервис аутентификации возвращает успешный ответ
    Тогда система возвращает результат "OK"
    И токен сохраняется в системе для будущих действий

  @negative
  Сценарий: Аутентификация с некорректным токеном (неправильная длина)
    Когда пользователь отправляет запрос с действием "LOGIN" и токеном короче 32 символов
    Тогда система возвращает результат "ERROR"
    И сообщение об ошибке содержит описание проблемы

  @negative
  Сценарий: Аутентификация с некорректным токеном (недопустимые символы)
    Когда пользователь отправляет запрос с действием "LOGIN" и токеном с символами в нижнем регистре
    Тогда система возвращает результат "ERROR"
    И сообщение об ошибке содержит описание проблемы

  @wiremock @negative
  Сценарий: Аутентификация при недоступности внешнего сервиса
    Когда пользователь отправляет запрос с действием "LOGIN" и корректным токеном
    И внешний сервис аутентификации возвращает ошибку
    Тогда система возвращает результат "ERROR"
    И сообщение об ошибке содержит описание проблемы

  @negative
  Сценарий: Аутентификация без обязательного токена
    Когда пользователь отправляет запрос с действием "LOGIN" без указания токена
    Тогда система возвращает результат "ERROR"
    И сообщение об ошибке содержит описание проблемы

  @negative @security
  Сценарий: Аутентификация с неправильным API-ключом
    Дано заголовок X-Api-Key установлен в "неправильный_ключ"
    Когда пользователь отправляет запрос с действием "LOGIN" и корректным токеном
    Тогда система возвращает результат "ERROR"