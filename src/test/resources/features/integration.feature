# language: ru
@integration @e2e
Функционал: Интеграционные сценарии
  Проверка полного цикла работы пользователя с системой

  Контекст:
    Дано сервер приложения доступен
    И заголовок X-Api-Key установлен в "A94F2C7D8E1B4A6F9C3D2E5B8A7F1C0D"
    И внешний сервис доступен и работает корректно

  @e2e @smoke
  Сценарий: Полный цикл работы пользователя
    Когда пользователь выполняет LOGIN с корректным токеном
    Тогда система возвращает результат "OK"
    И токен сохраняется в системе

    Когда пользователь выполняет ACTION с тем же токеном
    Тогда система возвращает результат "OK"

    Когда пользователь выполняет еще одно ACTION с тем же токеном
    Тогда система возвращает результат "OK"

    Когда пользователь выполняет LOGOUT с тем же токеном
    Тогда система возвращает результат "OK"

    Когда пользователь пытается выполнить ACTION после LOGOUT
    Тогда система возвращает результат "ERROR"

  @e2e @parallel
  Сценарий: Параллельная работа нескольких пользователей
    Дано два разных пользователя с разными токенами
    Когда первый пользователь выполняет LOGIN
    И второй пользователь выполняет LOGIN
    Тогда оба запроса возвращают результат "OK"

    Когда первый пользователь выполняет ACTION
    И второй пользователь выполняет ACTION
    Тогда оба запроса возвращают результат "OK"

    Когда первый пользователь выполняет LOGOUT
    Тогда система возвращает результат "OK"

    Когда первый пользователь пытается выполнить ACTION
    Тогда система возвращает результат "ERROR"

    Когда второй пользователь выполняет ACTION
    Тогда система возвращает результат "OK"